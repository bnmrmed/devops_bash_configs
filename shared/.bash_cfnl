#!/usr/bin/env bash

# CloudFormation Launcher - https://github.com/bonusbits/cfn_launcher

# Symlink
if [ ! -h "/usr/local/bin/cfnl" ]; then
   ln -s "$HOME/Development/github/bonusbits/cfn_launcher/cfn-launcher.sh" /usr/local/bin/cfnl
fi

function cfnl-show() {
    echo "CFNL_PATH: ($CFNL_PATH)"
}

function cfnl-set-vars() {
    cfnl_configs_path="$HOME/aws/cloudformation/cfnl_configs"
    region=$1
    aws_account=$2
    aws_env=$3
    project=$4

    export CFNL_PATH="$cfnl_configs_path/$region/$aws_account/$aws_env/$project"
    cfnl-show
}

# Default
cfnl-set-vars uswest2 account01 prd project01

function cfc() {
    echo "Running (/usr/local/bin/cfnl -f ${CFNL_PATH}/${1}.yml)"
    /usr/local/bin/cfnl -f "$CFNL_PATH/$1.yml"
}

function cfu() {
    echo "Running (/usr/local/bin/cfnl -u -f ${CFNL_PATH}/${1}.yml)"
    /usr/local/bin/cfnl -u -f "$CFNL_PATH/$1.yml"
}

function cfd() {
    echo "Running (/usr/local/bin/cfnl -d -f ${CFNL_PATH}/${1}.yml)"
    /usr/local/bin/cfnl -d -f "$CFNL_PATH/$1.yml"
}

# US WEST 2

## Account01
### DEV
#### Project01
alias set-cfnl-uw2-ac01-dev-project01="aws-set-ac01dev-public && cfnl-set-vars uswest2 account01 dev project01"
#### Project02
alias set-cfnl-uw2-ac01-dev-project02="aws-set-ac01dev-public && cfnl-set-vars uswest2 account01 dev project02"
#### Shared
alias set-cfnl-uw2-ac01-dev-shared="aws-set-ac01dev-public && cfnl-set-vars uswest2 account01 dev shared"

### PRD
#### Project01
alias set-cfnl-uw2-ac01-prd-project01="aws-set-ac01prd-public && cfnl-set-vars uswest2 account01 prd project01"
#### Project02
alias set-cfnl-uw2-ac01-prd-project02="aws-set-ac01prd-public && cfnl-set-vars uswest2 account01 prd project02"
#### Shared
alias set-cfnl-uw2-ac01-prd-shared="aws-set-ac01prd-public && cfnl-set-vars uswest2 account01 prd shared"

## Account02
### DEV
### Project01
alias set-cfnl-uw2-ac02-dev-project01="aws-set-ac02dev-public && cfnl-set-vars uswest2 account02 dev project01"

# Usage
## Folder Structure
# $HOME/aws/cloudformation/cfnl_configs/
#└── uswest2
#    └── account01
#        ├── dev
#        │   ├── project01
#        │   │   └── efs.yml
#        │   │   └── rds-snapshot.yml
#        │   │   └── web.yml
#        │   ├── shared
#        │   │   └── vpc.yml
#        │   │   └── utm.yml
#        │   └── project02
#        │       ├── efs.yml
#        │       └── rds-snapshot.yml
#        │       └── web.yml
#        └── prd
#            ├── project01
#            │   ├── efs.yml
#            │   ├── rds.yml
#            │   └── web.yml
#            ├── shared
#            │   ├── vpc.yml
#            │   └── utm.yml
#            └── project02
#                ├── efs.yml
#                ├── rds.yml
#                ├── web-blue.yml
#                └── web-green.yml

## Example Commands
# set-cfnl-uw2-ac01-dev-project01
# cfc web
# Would use $HOME/aws/cloudformation/cfnl_configs/uswest2/account01/dev/project01/web.yml
# set-cfnl-uw2-ac01-prd-project02
# cfc web-blue
# Would use $HOME/aws/cloudformation/cfnl_configs/uswest2/account01/prd/project02/web-blue.yml