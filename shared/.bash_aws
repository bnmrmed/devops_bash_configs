#!/bin/bash

# Kitchen-EC2
function aws-region(){
	export AWS_DEFAULT_REGION=$1
	export AWS_REGION=$1
}

## Default AWS Account
aws-region 'us-west-2'
export AWS_SSH_KEY_ID=account1_uswest2
export AWS_SSH_KEY_PATH=$HOME/.ssh/account1.pem
export AWS_PROFILE=account1
export AWS_VPC_ID=vpc-00000000
export AWS_SECURITY_GROUP_1=sg-00000000
export AWS_SECURITY_GROUP_2=sg-00000000
export AWS_IAM_INSTANCE_PROFILE_1=iam-instance-profile-name
export AWS_SUBNET=subnet-00000000
export AWS_PUBLIC_IP=false

function aws-clear(){
	# With varying number of SG and IAM Instance Profiles then need to be cleared in-between sets
	unset AWS_SSH_KEY_ID AWS_SSH_KEY_PATH AWS_PROFILE AWS_DEFAULT_REGION AWS_REGION AWS_VPC_ID AWS_SUBNET AWS_PUBLIC_IP
	unset AWS_IAM_INSTANCE_PROFILE_1 AWS_IAM_INSTANCE_PROFILE_2 AWS_IAM_INSTANCE_PROFILE_3 AWS_IAM_INSTANCE_PROFILE_4 AWS_IAM_INSTANCE_PROFILE_5
	unset AWS_SECURITY_GROUP_1 AWS_SECURITY_GROUP_2 AWS_SECURITY_GROUP_3 AWS_SECURITY_GROUP_4 AWS_SECURITY_GROUP_5
}

function aws-show() {
	echo ''
	echo "Configured AWS Environment Variables"
	echo "--------------------------------------"
	echo "AWS_SSH_KEY_ID = $AWS_SSH_KEY_ID"
	echo "AWS_SSH_KEY_PATH = $AWS_SSH_KEY_PATH"
	echo "AWS_PROFILE = $AWS_PROFILE"
	echo "AWS_DEFAULT_REGION = $AWS_DEFAULT_REGION"
	echo "AWS_REGION = $AWS_REGION"
	echo "AWS_VPC_ID = $AWS_VPC_ID"
	echo "AWS_SUBNET = $AWS_SUBNET"
	echo "AWS_PUBLIC_IP = $AWS_PUBLIC_IP"
	echo "AWS_IAM_INSTANCE_PROFILE_1 = $AWS_IAM_INSTANCE_PROFILE_1"
	if [ -n "$AWS_IAM_INSTANCE_PROFILE_2" ]; then	echo "AWS_IAM_INSTANCE_PROFILE_2 = $AWS_IAM_INSTANCE_PROFILE_2"; fi
	if [ -n "$AWS_IAM_INSTANCE_PROFILE_3" ]; then	echo "AWS_IAM_INSTANCE_PROFILE_3 = $AWS_IAM_INSTANCE_PROFILE_3"; fi
	if [ -n "$AWS_IAM_INSTANCE_PROFILE_4" ]; then	echo "AWS_IAM_INSTANCE_PROFILE_4 = $AWS_IAM_INSTANCE_PROFILE_4"; fi
	if [ -n "$AWS_IAM_INSTANCE_PROFILE_5" ]; then	echo "AWS_IAM_INSTANCE_PROFILE_5 = $AWS_IAM_INSTANCE_PROFILE_5"; fi
	echo "AWS_SECURITY_GROUP_1 = $AWS_SECURITY_GROUP_1";
	if [ -n "$AWS_SECURITY_GROUP_2" ]; then	echo "AWS_SECURITY_GROUP_2 = $AWS_SECURITY_GROUP_2"; fi
	if [ -n "$AWS_SECURITY_GROUP_3" ]; then	echo "AWS_SECURITY_GROUP_3 = $AWS_SECURITY_GROUP_3"; fi
	if [ -n "$AWS_SECURITY_GROUP_4" ]; then	echo "AWS_SECURITY_GROUP_4 = $AWS_SECURITY_GROUP_4"; fi
	if [ -n "$AWS_SECURITY_GROUP_5" ]; then	echo "AWS_SECURITY_GROUP_5 = $AWS_SECURITY_GROUP_5"; fi
	echo ''
}

function aws-envs(){
	echo ''
	echo "Enter an AWS Environments"
	echo "------------------------------------"
	echo "* account1 dev uswest2 private"
	echo "* account1 dev uswest2 public"
	echo "* account1 prd uswest2 private"
	echo "* account1 prd uswest2 public"
	echo "* account1 sandbox uswest2 public"
	echo "* account2 dev uswest2 private"
	echo "* account2 dev uswest2 public"
	echo "* account2 dev useast1 private"
	echo "* account2 dev useast1 public"
	echo "* account3 prd uswest2 public"
	echo ''
}

function aws-set(){
    # Skip if Argument is Null
    if [ -n "$1" ]; then
        aws-clear
        # Set Env Variable
        if [ "$1" == "account1" ]; then
            export AWS_PROFILE=account1

            if [ "$3" == "useast1" ]; then
                aws-region 'us-east-1'
            else
                aws-region 'us-west-2'
            fi

            # Default to Prd if Nil or if PRD passed
            if [ "$2" == "sandbox" ]; then
                export AWS_SSH_KEY_ID=account1-sandbox-useast1
                export AWS_SSH_KEY_PATH=$HOME/.ssh/account1-sandbox-useast1.pem
                export AWS_VPC_ID=vpc-00000000
                export AWS_SECURITY_GROUP_1=sg-00000000
                export AWS_SECURITY_GROUP_2=sg-00000000
                export AWS_IAM_INSTANCE_PROFILE_1=iam-instance-profile-name
                export AWS_SUBNET=subnet-00000000
            elif [ "$2" == "dev" ]; then
                export AWS_SSH_KEY_ID=account1_dev
                export AWS_SSH_KEY_PATH=$HOME/.ssh/account1_dev.pem
                export AWS_VPC_ID=vpc-000000
                export AWS_SECURITY_GROUP_1=sg-00000000
                export AWS_SECURITY_GROUP_2=sg-00000000
                export AWS_IAM_INSTANCE_PROFILE_1=iam-instance-profile-name
                if [ "$4" == "public" ]; then
                    # Public
                    export AWS_SUBNET=subnet-0000000
                    export AWS_PUBLIC_IP=true
                else
                    # Private
                    export AWS_SUBNET=subnet-0000000
                    export AWS_PUBLIC_IP=false
                fi
            else
                # Default to Prd if not args passed
                export AWS_SSH_KEY_ID=account1_prd
                export AWS_SSH_KEY_PATH=$HOME/.ssh/account1_prd.pem
                export AWS_VPC_ID=vpc-fefb4f9a
                export AWS_SECURITY_GROUP_1=sg-00000000
                export AWS_SECURITY_GROUP_2=sg-00000000
                export AWS_SECURITY_GROUP_3=sg-00000000
                export AWS_SECURITY_GROUP_4=sg-00000000
                export AWS_IAM_INSTANCE_PROFILE_1=iam-instance-profile-name
                if [ "$4" == "public" ]; then
                    # Public
                    export AWS_SUBNET=subnet-00000000
                    export AWS_PUBLIC_IP=true
                else
                    # Private
                    export AWS_SUBNET=subnet-00000000
                    export AWS_PUBLIC_IP=false
                fi
            fi
        elif [ "$1" == "account2" ]; then
            export AWS_PROFILE=account2

            if [ "$3" == "useast1" ]; then
                aws-region 'us-east-1'
            else
                aws-region 'us-west-2'
            fi

            # Default to my Lab USWest2
            if [ -n "$2" -o "$2" == "dev" ]; then
                export AWS_SSH_KEY_ID=account2-uswest2
                export AWS_SSH_KEY_PATH=$HOME/.ssh/account2-uswest2.pem
                export AWS_PROFILE=account2
                export AWS_VPC_ID=vpc-00000000
                export AWS_SECURITY_GROUP_1=sg-00000000
                export AWS_SECURITY_GROUP_2=sg-00000000
                export AWS_IAM_INSTANCE_PROFILE_1=iam-instance-profile-name
                if [ -n "$4" -o "$4" == "public" ]; then
                    # Public
                    export AWS_SUBNET=subnet-00000000
                    export AWS_PUBLIC_IP=true
                else
                    # Private
                    export AWS_SUBNET=subnet-00000000
                    export AWS_PUBLIC_IP=false
                fi
            fi
        elif [ $1 == "account3" ]; then
            export AWS_PROFILE=account3

            if [ "$3" == "useast1" ]; then
                aws-region 'us-east-1'
            else
                aws-region 'us-west-2'
            fi

            # Default to prd vpc
            if [ -n "$2" -o "$2" == "prd" ]; then
                export AWS_SSH_KEY_ID=account3
                export AWS_SSH_KEY_PATH=$HOME/.ssh/account3.pem
                export AWS_VPC_ID=vpc-00000000
                export AWS_SECURITY_GROUP_1=sg-00000000
                export AWS_SECURITY_GROUP_2=sg-00000000
                export AWS_IAM_INSTANCE_PROFILE_1=iam-instance-profile-name
                if [ -n "$4" -o "$4" == "public" ]; then
                    # Public
                    export AWS_SUBNET=subnet-00000000
                    export AWS_PUBLIC_IP=true
                else
                    # Private
                    export AWS_SUBNET=subnet-00000000
                    export AWS_PUBLIC_IP=false
                fi
            fi
        else
            # List Keys if Null or Wrong
            aws-envs
        fi
    else
        aws-envs
    fi

    # Display Env Variable Current Setting
    aws-show
}

# AWS EC2 CLI Tools
#export AWS_ACCESS_KEY=FAKEIEH5AWLS3ZHVS3OA
#export AWS_SECRET_KEY=FAKEcl8QLeR1pzZusu+ncbIdmtBzz6Gb3ej15igE
#export JAVA_HOME=$(/usr/libexec/java_home)
#export EC2_HOME="/usr/local/ec2/ec2-api-tools-1.7.5.1"
#export PATH=$PATH:$EC2_HOME/bin

# Aliases
alias aws-set-a1-dev-priate="aws-set account1 dev uswest2 private"
alias aws-set-a1-dev-public="aws-set account1 dev uswest2 public"
alias aws-set-a1-prd-priate="aws-set account1 prd uswest2 private"
alias aws-set-a1-prd-public="aws-set account1 prd uswest2 public"

alias aws-set-a2-dev-private="aws-set account2 dev uswest2 private"
alias aws-set-a2-dev-public="aws-set account2 dev uswest2 public"
alias aws-set-a2-prd-private="aws-set account2 dev uswest2 private"
alias aws-set-a2-prd-public="aws-set account2 dev uswest2 public"
